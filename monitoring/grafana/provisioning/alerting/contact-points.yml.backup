apiVersion: 1

contactPoints:
  - uid: slack-contact-point
    name: Slack Notifications
    type: slack
    settings:
      url: ${SLACK_WEBHOOK_URL}
      title: "InstaInstru Alert: {{ .GroupLabels.alertname }}"
      text: |
        {{ range .Alerts }}
        *Alert:* {{ .Labels.alertname }}
        *Severity:* {{ .Labels.severity }}
        *Summary:* {{ .Annotations.summary }}
        *Description:* {{ .Annotations.description }}
        *Service:* {{ .Labels.service }}
        *Status:* {{ .Status }}
        {{ if gt (len .GeneratorURL) 0 }}*Source:* <{{ .GeneratorURL }}|View in Grafana>{{ end }}
        {{ end }}
      username: Grafana
      icon_emoji: ":warning:"
    disableResolveMessage: false

  - uid: email-contact-point
    name: Email Notifications
    type: email
    settings:
      addresses: ${ALERT_EMAIL_ADDRESSES}
      singleEmail: false
      message: |
        {{ range .Alerts }}
        Alert: {{ .Labels.alertname }}
        Severity: {{ .Labels.severity }}
        Summary: {{ .Annotations.summary }}
        Description: {{ .Annotations.description }}
        Service: {{ .Labels.service }}
        Status: {{ .Status }}
        Time: {{ .StartsAt.Format "2006-01-02 15:04:05 MST" }}
        {{ end }}
    disableResolveMessage: false

  - uid: pagerduty-contact-point
    name: PagerDuty Critical
    type: pagerduty
    settings:
      integrationKey: ${PAGERDUTY_INTEGRATION_KEY}
      severity: critical
      class: infrastructure
      component: instainstru-backend
      group: production
      summary: |
        {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}
